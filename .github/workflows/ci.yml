- name: Deploy ke VPS
  uses: appleboy/ssh-action@master
  with:
    host: ${{ secrets.VPS_HOST }}
    username: ${{ secrets.VPS_USER }}
    key: ${{ secrets.GHA_KEY }}
    script: |
      set -e  # Stop on first error

      echo "Masuk ke direktori app..."
      cd ~/app

      echo "Menarik perubahan terbaru dari branch main..."
      git pull origin main

      echo "Menghapus container dan image lama (jika ada)..."
      sudo docker rm -f caritahu-container || true
      sudo docker rmi -f caritahu-app || true

      echo "Build Docker image terbaru..."
      sudo docker build -t caritahu-app .

      echo "Menjalankan container baru..."
      sudo docker run -d -p 80:80 --name caritahu-container caritahu-app

      echo "âœ… Deploy selesai."
